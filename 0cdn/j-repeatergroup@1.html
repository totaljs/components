<script>COMPONENT('repeater-group',function(self,config){var html,template_group,reg=/\$(index|path)/g;var force=false;self.readonly();self.released=function(is){if(is){html=self.html();self.empty()}else html&&self.html(html)};self.make=function(){self.find('script').each(function(index){var element=$(this);var html=element.html();element.remove();if(index)template_group=Tangular.compile(html);else self.template=Tangular.compile(html)})};self.configure=function(key,value,init){if(init)return;if(key==='group'){force=true;self.refresh()}};self.setter=function(value){if(!value||!value.length){self.empty();return}if(!force&&NOTMODIFIED(self.id,value))return;force=false;html='';var length=value.length,groups={};for(var i=0;i<length;i++){var name=value[i][config.group]||'0';if(groups[name])groups[name].push(value[i]);else groups[name]=[value[i]]}var index=0,indexgroup=0,builder='',keys=Object.keys(groups);keys.quicksort();keys.forEach(function(key){var arr=groups[key],tmp='';for(var i=0,length=arr.length;i<length;i++){var item=arr[i];item.index=index++;tmp+=self.template(item).replace(reg,function(text){return text.substring(0,2)==='$i'?index.toString():self.path+'['+index+']'})}if(key!=='0'){var options={};options[config.group]=key;options.length=arr.length;options.index=indexgroup++;options.body=tmp;builder+=template_group(options)}});self.append(builder)}});</script>