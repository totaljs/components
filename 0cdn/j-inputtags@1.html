<style>.ui-inputtags{position:relative;font-size:13px}.ui-inputtags-required .ui-inputtags-control{border-color:#D0D0D0}.ui-inputtags-label{margin-bottom:3px;font-size:12px}.ui-inputtags-label i{margin-right:4px}.ui-inputtags-required .ui-inputtags-label:before{content:'***';color:red;margin-right:3px}.ui-inputtags-control{border:1px solid #E0E0E0;border-radius:3px;min-height:32px;background-color:white}.ui-inputtags-input{padding:6px 2px 0 6px;position:relative;line-height:20px}.ui-inputtags-placeholder{position:absolute;color:gray;margin:0;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;cursor:text;width:100%;text-align:left;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-inputtags-icon-left{width:32px;height:30px;line-height:32px;float:left;text-align:center;border-right:1px solid #E0E0E0}.ui-inputtags-icon-right{width:32px;height:30px;line-height:32px;float:right;border-left:1px solid #E0E0E0;text-align:center}.ui-inputtags-required .ui-inputtags-icon-left{border-color:#D0D0D0}.ui-inputtags-required .ui-inputtags-icon-right{border-color:#D0D0D0}.ui-inputtags-ricon .ui-inputtags-input{margin-right:35px}.ui-inputtags-licon .ui-inputtags-input{margin-left:32px}.ui-inputtags-click{cursor:pointer}.ui-inputtags-error{margin-top:7px;font-size:11px;color:red}.ui-inputtags-dropdown, .ui-inputtags-dropdown .ui-inputtags-placeholder{cursor:pointer}.ui-inputtags-invalid .ui-inputtags-control, .ui-inputtags-invalid .ui-inputtags-icon-left, .ui-inputtags-invalid .ui-inputtags-icon-right{border-color:red}.ui-inputtags.ui-disabled .ui-inputtags-control{background-color:#F0F0F0}.ui-inputtags.ui-disabled .ui-inputtags-placeholder{color:#A0A0A0}.ui-inputtags.ui-disabled .ui-inputtags-icon-left, .ui-inputtags.ui-disabled .ui-inputtags-icon-right{color:gray}.ui-inputtags-inner .ui-inputtags-label{position:absolute;z-index:1;margin:12px 0 0 7px;font-size:13px}.ui-inputtags-inner.ui-inputtags-binded .ui-inputtags-label{font-size:11px;margin-top:3px;color:gray}.ui-inputtags-inner .ui-inputtags-input{padding-top:9px}.ui-inputtags-binded.ui-inputtags-inner .ui-inputtags-input{padding-top:15px}.ui-inputtags-inner .ui-inputtags-control{min-height:38px}.ui-inputtags-inner .ui-inputtags-icon-left, .ui-inputtags-inner .ui-inputtags-icon-right{height:100%;line-height:37px}.ui-inputtags-inner.ui-inputtags-required .ui-inputtags-label:before{content:'*'}.ui-inputtags-tags{padding:1px 0 3px}.ui-inputtags-tags span{padding:2px 5px;line-height:12px;margin:0 3px 3px 0;cursor:default}.ui-inputtags-tags span i{margin-right:4px;font-size:12px;cursor:pointer;transition:transform 0.1s;-webkit-transition:transform 0.1s;-moz-transition:transform 0.1s;-ms-transition:transform 0.1s}.ui-inputtags-tags span i:hover{transform:scale(1.2);-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2)}.ui-inputtags-tag{position:relative;display:inline-block;color:white;background-color:#4783EE;color:white;border-radius:2px;border:1px solid #3A6FCF}.ui-inputtags-editable{outline:0;min-width:50px;padding-left:1px !important;padding-right:1px;width:100%;line-height:12px}.ui-dark .ui-inputtags-required .ui-inputtags-control{border-color:#404040}.ui-dark .ui-inputtags-control{border-color:#303030;background-color:#202020}.ui-dark .ui-inputtags-required .ui-inputtags-icon-left{border-color:#404040}.ui-dark .ui-inputtags-required .ui-inputtags-icon-right{border-color:#404040}.ui-dark .ui-inputtags-control input{background-color:#202020;color:white}.ui-dark .ui-inputtags-control{background-color:#202020}.ui-dark .ui-inputtags-icon-left, .ui-dark .ui-inputtags-icon-right{border-color:#303030;color:gray}.ui-dark .ui-inputtags-required .ui-inputtags-control{border-color:#404040}.ui-dark .ui-inputtags-control{border-color:#303030;background-color:#202020}.ui-dark .ui-inputtags-required .ui-inputtags-icon-left{border-color:#404040}.ui-dark .ui-inputtags-required .ui-inputtags-icon-right{border-color:#404040}.ui-dark .ui-inputtags-control inputtags{background-color:#202020;color:white}.ui-dark .ui-inputtags-control{background-color:#202020}.ui-dark .ui-inputtags-icon-left, .ui-dark .ui-inputtags-icon-right{border-color:#303030;color:gray}.ui-dark .ui-inputtags.ui-disabled .ui-inputtags-control{background-color:#282828}.ui-dark .ui-inputtags.ui-disabled inputtags{background-color:#282828;color:#777777}.ui-dark .ui-inputtags.ui-disabled .ui-inputtags-placeholder{color:#777777}.ui-disabled .ui-inputtags-tags span i{display:none}.ui-disabled .ui-inputtags-tag{background-color:#D0D0D0;color:gray;border:1px solid #C0C0C0}.ui-dark .ui-disabled .ui-inputtags-tag{background-color:#202020;color:gray;border:1px solid #101010}</style>
<script>COMPONENT('inputtags@1','dirkey:name;dirvalue:id;after:\\:',function(self,config){var cls='ui-inputtags',cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,tags,skip=false;self.init=function(){Thelpers.ui_inputtags_icon=function(val){return val.charAt(0)==='!'?('<span class="ui-inputtags-icon-custom">'+val.substring(1)+'</span>'):('<i class="fa fa-'+val+'"></i>')};W.ui_inputtags_template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="fa fa-{{ icon}}"></i>{{ fi}}{{ label}}{{ after}}</div>{{ fi}}<div class="{0}-control{{ if dirsource}} {0}-dropdown{{ fi}}{{ if licon}} {0}-licon{{ fi}}{{ if ricon}} {0}-ricon{{ fi}}">{{ if ricon}}<div class="{0}-icon-right">{{ ricon | ui_inputtags_icon}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick}} {0}-click{{ fi}}">{{ licon | ui_inputtags_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder && !innerlabel}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}<div class="{0}-tags"><span class="{0}-editable" contenteditable="true"></span></div></div></div>{{ if error}}<div class="{0}-error hidden"><i class="fa fa-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};self.make=function(){if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;config.PATH=self.path.replace(/\./g,'_');self.aclass(cls+' invisible');self.rclass('invisible',100);self.redraw();self.event('input change',function(){self.check()});self.event('focus',cls2+'-editable',function(){self.aclass(cls+'-focused');config.autocomplete&&EXEC(config.autocomplete,self,input.parent());if(config.autosource){var opt={};opt.element=self.element;opt.search=GET(config.autosource);opt.callback=function(value){input.empty();self.appendval(typeof(value)==='string'?value:value[config.autovalue]);self.check()};SETTER('autocomplete','show',opt)}});self.event('blur',cls2+'-editable',function(){self.rclass(cls+'-focused')});self.event('click','.fa-times',function(e){var index=$(this).parent().index();self.removetag(index);e.stopPropagation();e.preventDefault()});self.event('click',cls2+'-tag',function(e){e.stopPropagation();e.preventDefault()});self.findvalue=function(arr,val){for(var i=0;i<arr.length;i++){if(arr[i]&&(arr[i]===val||arr[i][config.value]===val))return arr[i]}};self.event('click',cls2+'-control',function(){if(!config.dirsource||config.disabled)return;var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource;opt.offsetY=-1;opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(config.dirrender):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;if(config.dirvalue){var val=self.get()||EMPTYARRAY;opt.exclude=function(item){return item?typeof(item)==='string'?self.findvalue(val,item):self.findvalue(val,item[config.dirvalue]):false}}opt.callback=function(item,el,custom){if(item==null)return;var val=custom||typeof(item)==='string'?item:item[config.dirvalue||config.value];if(custom&&typeof(config.dircustom)==='string'){var fn=GET(config.dircustom);fn(val,function(val){self.appendval(val,true)})}else if(!custom)self.appendval(val)};SETTER('directory','show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label,'+cls2+'-input',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.element.find(cls2+'-control').trigger('click')}else input.focus()}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(left&&config.liconclick)EXEC(config.liconclick,self,el);else if(config.riconclick)EXEC(config.riconclick,self,el)})};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if(!config.required||config.disabled)return true;if(config.dirsource)return!!value;if(customvalidator)return customvalidator(value);if(value==null)value=EMPTYARRAY;return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.setter=function(){if(skip)skip=false;else self.bindvalue()};self.appendval=function(value,custom){var cur=self.get()||EMPTYARRAY;var is=false;if(cur.indexOf(value)!==-1)return;if(!self.checkvalue(value))return;if(config.dirsource){if(custom){is=true;self.appendtag(value)}else{var item=dirsource.findItem(config.dirvalue,value);if(item){is=true;self.appendtag(item[config.dirkey])}}}else{is=true;self.appendtag(value)}if(is){skip=true;self.push(value);self.change(true)}self.check()};self.appendtag=function(text){input.before('<span class="{0}-tag"><i class="fa fa-times"></i>{1}</span>'.format(cls,Thelpers.encode(text)))};self.removetag=function(index){skip=true;tags.find('span').eq(index).remove();self.get().splice(index,1);self.update(true);self.change(true);self.check()};self.checkvalue=function(val){return config.check?GET(config.check)(val):true};self.check=function(){var is=!!input[0].innerHTML||(self.get()||EMPTYARRAY).length>0;if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-right').find('i').tclass(config.ricon,!is).tclass('fa-times',is)};self.bindvalue=function(){var value=self.get()||EMPTYARRAY;tags.find(cls2+'-tag').remove();if(dirsource){var arr=[],item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];if(typeof(item)==='string'){if(value.indexOf(item)===-1)continue;arr.push(item)}else if(value.indexOf(item[config.dirvalue||config.value])!=-1)arr.push(item[config.dirkey||config.key])}if(value&&item==null&&config.dircustom)arr.push(value);for(var i=0;i<arr.length;i++)self.appendtag(arr[i])}else{for(var i=0;i<value.length;i++)self.appendtag(value[i])}input.empty();self.check()};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down'}self.html(W.ui_inputtags_template(config));input=self.find(cls2+'-editable');tags=self.find(cls2+'-tags');placeholder=self.find(cls2+'-placeholder');input.on('paste',function(e){e.preventDefault();e.stopPropagation();var text=e.originalEvent.clipboardData.getData(self.attrd('clipboard')||'text/plain');text&&document.execCommand('insertText',false,text)});input.on('keydown',function(e){var el;if(e.which===13){e.preventDefault();e.stopPropagation();el=$(this);setTimeout(function(){var val=el.text();val&&self.appendval(val);el.html('')},100)}else if(e.which===8){if(!this.innerHTML){var prev=$(this).prev();prev.length&&self.removetag(prev.index())}}})};self.configure=function(key,value){switch(key){case'dirsource':input.prop('contenteditable',!value);self.datasource(value,function(path,value){dirsource=value||EMPTYARRAY;self.bindvalue()});break;case'disabled':self.tclass('ui-disabled',value==true);input.attr('contenteditable',!value);self.reset();break;case'required':self.tclass(cls+'-required',value==true);self.reset();break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?FN('value=>'+value):(function(path){return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',value);break}};self.formatter(function(path,value){if(value){switch(config.type){case'lower':return value.toString().toLowerCase();case'upper':return value.toString().toUpperCase()}}return value});self.parser(function(path,value){if(value){switch(config.type){case'lower':value=value.toLowerCase();break;case'upper':value=value.toUpperCase();break}}return value?config.spaces===false?value.replace(/\s/g,''):value:value});self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)}});</script>