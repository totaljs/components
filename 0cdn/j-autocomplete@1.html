<style>.ui-autocomplete-container{position:absolute;z-index:60}.ui-autocomplete{background-color:#FFF;width:100%;margin:-5px 0 0;padding:2px 0;border-radius:0 0 var(--radius) var(--radius);box-shadow:0 5px 20px rgba(0,0,0,0.1);border:1px solid #E0E0E0;line-height:14px;overflow:hidden}.ui-autocomplete ul{list-style-type:none;margin:0;padding:0}.ui-autocomplete li{margin:0;padding:0 12px;border-bottom:1px solid #F0F0F0;cursor:pointer;font-size:13px;color:#505050;height:30px;line-height:30px}.ui-autocomplete li:last-child{border-bottom:0}.ui-autocomplete .selected{background-color:#F0F0F0}.ui-autocomplete li span{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}.ui-dark .ui-autocomplete{background-color:#303030;border-color:#404040}.ui-dark .ui-autocomplete li{color:gray;border-bottom-color:#404040}.ui-dark .ui-autocomplete .selected{background-color:#454545;color:#FFF}</style>
<script>COMPONENT('autocomplete@1','height:200',function(self,config,cls){var clssel='selected',container,old,searchtimeout,searchvalue,blurtimeout,datasource,offsetter,scroller,skipmouse=false,margin={},is=false,prev;self.template=Tangular.compile('<li{{ if select}} class="'+clssel+'"{{ fi}} data-index="{{ index}}"><span>{{ name}}</span></li>');self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+'-container hidden');self.html('<div class="'+cls+'"><div class="noscrollbar"><ul></ul></div></div>');scroller=self.find('.noscrollbar');container=self.find('ul');self.event('click','li',function(e){e.preventDefault();e.stopPropagation();if(self.opt.callback){var val=datasource[+$(this).attrd('index')];self.opt.scope&&M.scope(self.opt.scope);if(self.opt.path)SET(self.opt.path,val.value===undefined?val.name:val.value);else self.opt.callback(val,old)}self.visible(false)});self.event('mouseenter mouseleave','li',function(e){if(!skipmouse){prev&&prev.rclass(clssel);prev=$(this).tclass(clssel,e.type==='mouseenter')}});$(document).on('click',function(){is&&self.visible(false)});self.on('scroll + resize + reflow + resize2',function(){is&&self.visible(false)})};self.prerender=function(value){self.render(value)};self.configure=function(name,value){switch(name){case'height':value&&scroller.css('height',value);break}};function keydown(e){var c=e.which,input=this;if(c!==38&&c!==40&&c!==13){if(c!==8&&c<32)return;clearTimeout(searchtimeout);searchtimeout=setTimeout(function(){var val=input.value||input.innerHTML;if(!val)return self.render(EMPTYARRAY);if(searchvalue===val)return;searchvalue=val;self.resize();self.opt.search(val,self.prerender)},200);return}if(!datasource||!datasource.length||!is)return;var current=container.find('.'+clssel);if(c===13){if(prev){prev=null;self.visible(false);if(current.length){var val=datasource[+current.attrd('index')];self.opt.scope&&M.scope(self.opt.scope);if(self.opt.callback)self.opt.callback(val,old);else if(self.opt.path)SET(self.opt.path,val.value===undefined?val.name:val.value);e.preventDefault();e.stopPropagation()}}return}e.preventDefault();e.stopPropagation();if(current.length){current.rclass(clssel);current=c===40?current.next():current.prev()}skipmouse=true;!current.length&&(current=self.find('li:{0}-child'.format(c===40?'first':'last')));prev&&prev.rclass(clssel);prev=current.aclass(clssel);var index=+current.attrd('index');var h=current.innerHeight();var offset=((index+1)*h)+(h*2);scroller[0].scrollTop=offset>config.height?offset-config.height:0;setTimeout2(self.ID+'skipmouse',function(){skipmouse=false},100)}function blur(){clearTimeout(blurtimeout);blurtimeout=setTimeout(self.visible,300,false)}self.visible=function(visible){clearTimeout(blurtimeout);self.tclass('hidden',!visible);is=visible};self.resize=function(){if(!offsetter||!old)return;var offset=offsetter.offset();offset.top+=offsetter.height();offset.width=offsetter.width();if(margin.left)offset.left+=margin.left;if(margin.top)offset.top+=margin.top;if(margin.width)offset.width+=margin.width;self.css(offset)};self.show=function(opt,callback){clearTimeout(searchtimeout);var selector='input,[contenteditable]';if(callback)opt.callback=callback;if(opt.input==null)opt.input=opt.element;opt.input=opt.input.setter?opt.input.find(selector):$(opt.input);if(opt.input[0].tagName!=='INPUT'&&!opt.input.attr('contenteditable'))opt.input=opt.input.find(selector);if(opt.element.setter){if(!opt.callback)opt.callback=opt.element.path;opt.element=opt.element.element}if(old){old.removeAttr('autocomplete');old.off('blur',blur);old.off('keydown',keydown)}opt.input.on('keydown',keydown);opt.input.on('blur',blur);opt.input.attr('autocomplete','off');old=opt.input;margin.left=opt.offsetX;margin.top=opt.offsetY;margin.width=opt.offsetWidth;opt.scope=M.scope?M.scope():'';offsetter=$(opt.element);self.opt=opt;self.resize();searchvalue='';self.visible(false)};self.attach=function(input,search,callback,left,top,width){self.attachelement(input,input,search,callback,left,top,width)};self.attachelement=function(element,input,search,callback,left,top,width){if(typeof(callback)==='number'){width=left;left=top;top=callback;callback=null}var opt={};opt.offsetX=left;opt.offsetY=top;opt.offsetWidth=width;if(typeof(callback)==='string')opt.path=callback;else opt.callback=callback;opt.search=search;opt.element=input;opt.input=input;self.show(opt)};self.render=function(arr){datasource=arr;if(!arr||!arr.length){self.visible(false);return}var builder=[];for(var i=0;i<arr.length;i++){var obj=arr[i];if(!i&&self.opt.autoselect)obj.select=true;obj.index=i;if(!obj.name)obj.name=obj.text;builder.push(self.template(obj))}container.empty().append(builder.join(''));skipmouse=true;setTimeout(function(){scroller[0].scrollTop=0;skipmouse=false},100);prev=container.find('.'+clssel);self.visible(true);setTimeout(scroller.noscrollbar,100,true)}});</script>