<style>.ui-dynamicvalue-label{margin-bottom:3px;font-size:12px;text-align:left;color:#777}.ui-dynamicvalue-label i{margin-right:5px}.ui-dynamicvalue{height:36px;border:1px solid #E0E0E0;border-radius:var(--radius);background-color:#FFF;cursor:pointer;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.ui-dynamicvalue-value{cursor:pointer;display:block;padding:0 0 0 8px;margin-right:36px;user-select:none;-webkit-user-select:none;-moz-user-select:none;font:normal 13px Arial;color:gray;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:35px}.ui-dynamicvalue-icon{color:#000;cursor:pointer;width:36px;float:right;border-left:1px solid #E0E0E0;text-align:center;padding:0;line-height:35px}.ui-dynamicvalue-is .ui-dynamicvalue-value{color:#000}.ui-dynamicvalue-is .ti-times{color:red;width:35px;display:block;line-height:35px}.ui-dynamicvalue-required .ui-dynamicvalue-label:before{color:red;content:'*';margin-right:3px}.ui-dynamicvalue-required .ui-dynamicvalue-icon{border-left-color:#D0D0D0}.ui-dynamicvalue-required .ui-dynamicvalue{border-color:#D0D0D0}.ui-dynamicvalue-invalid .ui-dynamicvalue{border:1px solid red}.ui-dynamicvalue-invalid .ui-dynamicvalue-icon{border-left-color:red}.ui-disabled .ui-dynamicvalue *{cursor:not-allowed}.ui-disabled .ui-dynamicvalue{background-color:#F0F0F0}.ui-disabled .ui-dynamicvalue-value{color:gray}.ui-disabled .ui-dynamicvalue-icon i{color:gray !important}.ui-dark .ui-dynamicvalue{border-color:#3A3A3A;background-color:#202020;color:#707070}.ui-dark .ui-dynamicvalue-icon{border-left-color:#3A3A3A;color:#707070}.ui-dark .ui-dynamicvalue-is .ui-dynamicvalue-value{color:#FFF}.ui-dark .ui-dynamicvalue-required .ui-dynamicvalue-label:before{color:red}.ui-dark .ui-dynamicvalue-required .ui-dynamicvalue-icon{border-color:#424242}.ui-dark .ui-dynamicvalue-required .ui-dynamicvalue{border-color:#424242}.ui-dark .ui-dynamicvalue-invalid .ui-dynamicvalue{border-color:red !important;background-color:#202020 !important}.ui-dark .ui-dynamicvalue-invalid .ui-dynamicvalue-icon{border-left-color:red;color:red}.ui-dark .ui-disabled .ui-dynamicvalue{background-color:#282828}.ui-dark .ui-disabled .ui-dynamicvalue-value{color:#777}</style>
<script>COMPONENT('dynamicvalue@1','html:{{ name}};icon2:angle-down;tapi:0;loading:1',function(self,config,cls){var cls2='.'+cls;self.nocompile();self.validate=function(value){return!config.required||config.disabled?true:!!value};self.state=function(type){if(!type)return;var invalid=config.required?self.isInvalid():false;if(invalid===self.$oldstate)return;self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid)};self.configure=function(key,value){switch(key){case'html':config.html=Tangular.compile(value);break;case'label':var label=self.find(cls2+'-label');label.tclass('hidden',!value);label.find('span').html((value||'')+':');break;case'required':self.noValid(!value);!value&&self.state(1,1);self.tclass(cls+'-required',value);break;case'disabled':self.tclass('ui-disabled',value);break;case'icon':var ti=self.find(cls2+'-label').find('i');ti.rclass2('ti-').rclass('hidden');if(value)ti.aclass('ti-'+value);else ti.aclass('hidden');break;case'remap':config.remap=value?FN(value):null;break}};self.make=function(){if(!config.label)config.label=self.html();self.aclass(cls+'-container');self.html('<div class="{2}-label{3}"><i class="ti hidden"></i><span>{1}:</span></div><div class="{2}"><div class="{2}-icon"><i class="ti ti-times"></i></div><div class="{2}-value">{0}</div></div>'.format(config.placeholder,config.label,cls,config.label?'':' hidden'));self.event('click','.'+cls,function(){if(config.disabled)return;if(config.dirsource){var opt={};opt.element=self.element;opt.offsetY=-1;opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;opt.key=config.dirkey;opt.items=function(value,next){if(config.dirsource.indexOf(' ')!==-1||config.tapi){var val=encodeURIComponent(value);var fn=config.tapi?TAPI:AJAX;fn(config.dirsource.format(val).args({value:val}),next)}else self.EXEC(config.dirsource,value,next)};opt.callback=function(selected){self.set(selected[config.dirvalue||'id']);self.change();config.required&&setTimeout(self=>self.validate2(),100,self)};SETTER('directory','show',opt)}else{self.EXEC(config.click||config.find,self.element,function(value){self.set(value);self.change();config.required&&setTimeout(self=>self.validate2(),100,self)},self.get())}});self.event('click','.ti-times',function(e){e.preventDefault();e.stopPropagation();if(!config.disabled){self.change();self.set(null)}})};self.bindvalue=function(value){config.bind&&self.SEEX(config.bind,value);if(config.remap)value=config.remap(value);self.tclass(cls+'-is',!!value);var ti=self.find(cls2+'-icon').find('i');ti.rclass2('ti-');if(value)ti.aclass('ti-times');else ti.aclass('ti-'+config.icon2);var val=(value?config.html(value):config.placeholder)||'';var body=self.find(cls2+'-value');if(body.html()!==val)body.html(val);config.loading&&SETTER('loading','hide',200);self.response=value;config.onresponse&&self.SEEX(config.onresponse,value)};self.setter=function(value,path,type){if(value){if(config.url){config.loading&&SETTER('loading','show');var val=encodeURIComponent(value);if(config.tapi)TAPI(config.url.format(val).args({value:val}),self.bindvalue);else AJAX((config.url.indexOf(' ')===-1?'GET ':'')+config.url.format(val).args({value:val}),self.bindvalue)}else self.EXEC(config.exec||config.read,value,self.bindvalue,type)}else self.bindvalue(value)}});</script>