<style>.ui-dropdownlist label{margin-bottom:3px;font-size:12px;color:#777;display:block}.ui-dropdownlist label i{margin-right:5px}.ui-dropdownlist-required label:before{content:'*';color:red;margin-right:3px}.ui-dropdownlist-values{border:1px solid #E0E0E0;border-radius:var(--radius)}.ui-dropdownlist-required .ui-dropdownlist-values{border-color:#D0D0D0}.ui-dropdownlist-add{height:34px;line-height:33px;padding:0 0 0 10px;font-size:12px;color:#777;cursor:pointer;display:block;border-radius:var(--radius) var(--radius) 0 0}.ui-dropdownlist-empty{font-size:11px;padding:10px 0;color:#777;text-align:center}.ui-disabled .ui-dropdownlist-add, .ui-dropdownlist-limited .ui-dropdownlist-add{background-color:#F0F0F0;cursor:not-allowed}.ui-dropdownlist-control{float:right;width:34px;height:34px;line-height:34px;text-align:center;border-left:1px solid #E0E0E0;color:#000;cursor:pointer}.ui-dropdownlist-required .ui-dropdownlist-control{border-left-color:#D0D0D0}.ui-dropdownlist-item{line-height:33px;height:34px;border-top:1px solid #E0E0E0;font-size:12px;color:#000}.ui-disabled .ui-dropdownlist-item{background-color:#F8F8F8;color:#777}.ui-disabled .ui-dropdownlist-item .ui-dropdownlist-control{display:none}.ui-dropdownlist-required .ui-dropdownlist-item{border-top-color:#D0D0D0}.ui-dropdownlist-item .ui-dropdownlist-control{color:red}.ui-dropdownlist-item .name{margin-right:34px;line-height:33px;padding:0 5px 0 10px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ui-dropdownlist-item .name i{width:14px;position:relative;display:inline-block;margin-right:5px;text-align:center}.ui-dropdownlist-item .remove{width:26px;float:right;text-align:center;line-height:26px;color:red;cursor:pointer}.ui-dark .ui-dropdownlist label{color:#777}.ui-dark .ui-dropdownlist-required label:before{color:red}.ui-dark .ui-dropdownlist-values{border-color:#404040}.ui-dark .ui-dropdownlist-required .ui-dropdownlist-values{border-color:#505050}.ui-dark .ui-dropdownlist-add{color:#777}.ui-dark .ui-dropdownlist-empty{color:#777}.ui-dark .ui-disabled .ui-dropdownlist-add, .ui-dark .ui-dropdownlist-limited .ui-dropdownlist-add{background-color:#282828}.ui-dark .ui-dropdownlist-control{border-left-color:#404040;color:#777}.ui-dark .ui-dropdownlist-required .ui-dropdownlist-control{border-left-color:#505050}.ui-dark .ui-dropdownlist-item{border-top-color:#404040;color:#E0E0E0}.ui-dark .ui-disabled .ui-dropdownlist-item{background-color:#323232;color:#777}.ui-dark .ui-dropdownlist-required .ui-dropdownlist-item{border-top-color:#505050}.ui-dark .ui-dropdownlist-item .ui-dropdownlist-control{color:red}.ui-dark .ui-dropdownlist-item .remove{color:red}</style>
<script>COMPONENT('dropdownlist@1','limit:3;check:true',function(self,config,cls){var cls2='.'+cls,items,nocheck=false;self.template=Tangular.compile('<div class="{0}-item" data-id="{{ id}}"><span class="{0}-control {0}-remove"><i class="ti ti-times"></i></span><div class="name">{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ name}}</div></div>'.format(cls));self.getter=null;self.validate=function(value){return(!config.required||config.disabled)?true:(value&&value.length>0)};self.uncheck=function(){var items=self.get();nocheck=false;self.tclass(cls+'-limited',items&&config.limit?items.length>=config.limit:false)};self.make=function(){var label=self.element.text()||config.label;self.aclass(cls+(config.required?(' '+cls+'-required'):''));self.html('<label>{2}:</label><div class="{0}-values"><div class="{0}-add"><span class="{0}-control"><i class="ti ti-angle-down"></i></span>{1}</div><div class="{0}-items"></div></div>'.format(cls,config.placeholder,label));items=self.find(cls2+'-items');self.event('click',cls2+'-add',function(){if(self.hclass(cls+'-limited')||config.disabled)return;var items=self.get();var datasource=typeof(config.datasource)==='string'?GET(self.makepath(config.datasource)):config.datasource;var opt={};opt.element=$(this);if(config.dirplaceholder)opt.placeholder=config.dirplaceholder;if(config.dirsearch)opt.search=config.dirsearch;opt.offsetX=-1;opt.offsetY=-1;opt.offsetWidth=12;opt.items=datasource.slice(0);if((items&&items.length)){opt.items=opt.items.remove(function(item){return items&&items.length&&items.findIndex('id',item.id)!==-1})}opt.callback=function(value){value=CLONE(value);delete value.selected;delete value.checked;delete value.template;var items=self.get()||[];if(items.findItem('id',value.id))return;items.unshift(value);if(config.limit&&items.length>config.limit)items.splice(config.limit);nocheck=true;self.bind('@touched @modified @setter',items);setTimeout(self.uncheck,100)};SETTER('directory/show',opt)});self.event('click',cls2+'-remove',function(){if(config.disabled)return;var el=$(this).closest(cls2+'-item');var id=ATTRD(el);var arr=self.get();var index=arr.findIndex('id',id);arr.splice(index,1);nocheck=true;self.bind('@touched @modified @setter',arr);setTimeout(self.uncheck,100)})};self.configure=function(key,value){if(key==='datasource'){if(value.includes(','))config.datasource=config.datasource.parseSource()}else if(key==='disabled')self.tclass('ui-disabled',value)};self.check=function(){var items=self.get()||[];var check=typeof(config.datasource)==='string'?GET(self.makepath(config.datasource)):config.datasource;items.wait(function(item,next){var m=check.findItem('id',item.id);if(m){item.name=m.name;item.icon=m.icon;item.unit=m.unit}else item.id='';next()},function(){nocheck=true;self.bind('@touched @modified @setter',items.remove('id',''));setTimeout(self.uncheck,100)})};self.redraw=function(){var value=self.get()||[];var builder=[];for(var item of value)builder.push(self.template(item));items.html(builder.join(''));setTimeout(self.uncheck,100)};self.setter=function(){if(nocheck||!config.check)self.redraw();else self.check()}});</script>